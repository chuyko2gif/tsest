-- ========================================
-- –°–û–ó–î–ê–ù–ò–ï STORAGE –î–õ–Ø –ö–ê–†–¢–ò–ù–û–ö –ù–û–í–û–°–¢–ï–ô
-- ========================================
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ Supabase Storage

-- ‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Supabase Dashboard, –∞ –Ω–µ –≤ SQL Editor!

-- ========================================
-- –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï STORAGE
-- ========================================

-- –®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å bucket –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
-- -------------------------------------------
-- 1. –ü–µ—Ä–µ–π–¥–∏ –≤ Supabase Dashboard ‚Üí Storage
-- 2. –ù–∞–∂–º–∏ "Create bucket"
-- 3. –ó–∞–ø–æ–ª–Ω–∏:
--    - Name: news-images
--    - Public bucket: ‚úì (–≥–∞–ª–æ—á–∫–∞) - —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º
-- 4. –ù–∞–∂–º–∏ "Create"

-- –®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
-- -------------------------------------------
-- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ–≥–æ –∏ –ø–µ—Ä–µ–π–¥–∏ –≤ Policies

-- –ü–û–õ–ò–¢–ò–ö–ê 1: –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
-- –ù–∞–∑–≤–∞–Ω–∏–µ: "Public read for news images"
-- Allowed operation: SELECT
-- Policy definition:
CREATE POLICY "Public read for news images"
ON storage.objects FOR SELECT
USING (bucket_id = 'news-images');

-- –ü–û–õ–ò–¢–ò–ö–ê 2: –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å
-- –ù–∞–∑–≤–∞–Ω–∏–µ: "Admins can upload news images"  
-- Allowed operation: INSERT
-- Policy definition:
CREATE POLICY "Admins can upload news images"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
  bucket_id = 'news-images' AND
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'admin'
  )
);

-- –ü–û–õ–ò–¢–ò–ö–ê 3: –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å
-- –ù–∞–∑–≤–∞–Ω–∏–µ: "Admins can delete news images"
-- Allowed operation: DELETE
-- Policy definition:
CREATE POLICY "Admins can delete news images"
ON storage.objects FOR DELETE
TO authenticated
USING (
  bucket_id = 'news-images' AND
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.role = 'admin'
  )
);

-- ========================================
-- –ü–†–û–í–ï–†–ö–ê
-- ========================================

-- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω
-- –í—ã–ø–æ–ª–Ω–∏ –≤ SQL Editor:
SELECT 
  id,
  name,
  public
FROM storage.buckets
WHERE name = 'news-images';

-- –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Å—Ç—Ä–æ–∫—É —Å name = 'news-images' –∏ public = true - –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

-- ========================================
-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø
-- ========================================

-- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —Ç–∏–ø—ã:
-- –≠—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ):
-- - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB
-- - –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã: image/*

-- ========================================
-- –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
-- ========================================

-- –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Storage:
-- 1. –ó–∞–π–¥–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ù–æ–≤–æ—Å—Ç–∏
-- 2. –í –ø–æ–ª–µ "–ö–∞—Ä—Ç–∏–Ω–∫–∞" –Ω–∞–∂–º–∏ "üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞"
-- 3. –í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª - –æ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤ Supabase Storage
-- 4. URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ

-- –§–æ—Ä–º–∞—Ç URL –±—É–¥–µ—Ç:
-- https://[project-ref].supabase.co/storage/v1/object/public/news-images/news/[filename]

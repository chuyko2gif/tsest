# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–ª–∏–∑–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∏–∫–µ—Ç–æ–≤

## üìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–æ–≤

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–ª–∏–∑–æ–≤
–í—ã–ø–æ–ª–Ω–∏—Ç–µ: `create_releases_unified.sql`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç:
- ‚úÖ –¢–∞–±–ª–∏—Ü—É `releases` —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ —Å —Ç–∏–∫–µ—Ç–∞–º–∏
–í—ã–ø–æ–ª–Ω–∏—Ç–µ: `add_release_id_to_tickets.sql`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç:
- ‚úÖ –ü–æ–ª–µ `release_id` –≤ —Ç–∞–±–ª–∏—Ü—É `support_tickets`
- ‚úÖ Foreign key —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π `releases`
- ‚úÖ –ò–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `releases`

## üéØ –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å

### –í Supabase Dashboard:
1. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `create_releases_unified.sql`
4. –ù–∞–∂–º–∏—Ç–µ **Run**
5. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è `add_release_id_to_tickets.sql`

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø):
```bash
psql -h your-host -U postgres -d your-database -f sql/create_releases_unified.sql
psql -h your-host -U postgres -d your-database -f sql/add_release_id_to_tickets.sql
```

## ‚ú® –ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–∏—Ä–∞—Ç—å —Ä–µ–ª–∏–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∏–∫–µ—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–†–µ–ª–∏–∑—ã"
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–ª–∏–∑–µ (–æ–±–ª–æ–∂–∫–∞, –∞—Ä—Ç–∏—Å—Ç, –Ω–∞–∑–≤–∞–Ω–∏–µ) –≤ —Ç–∏–∫–µ—Ç–µ
- –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–ª–∏–∑—É –∏–∑ —Ç–∏–∫–µ—Ç–∞

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- –í–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ä–µ–ª–∏–∑–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Ç–∏–∫–µ—Ç–æ–≤
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ä–∞–∑—É –≤–∏–¥–µ–Ω
- –£–¥–æ–±—Å—Ç–≤–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ —Ä–µ–ª–∏–∑–∞–º

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—è release_id

```sql
release_id UUID REFERENCES public.releases(id) ON DELETE SET NULL
```

- **–¢–∏–ø**: UUID
- **Nullable**: –î–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- **Foreign Key**: –°–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π releases
- **ON DELETE SET NULL**: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞, –ø–æ–ª–µ –æ–±–Ω—É–ª—è–µ—Ç—Å—è (—Ç–∏–∫–µ—Ç –æ—Å—Ç–∞–µ—Ç—Å—è)

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–∏–∫–µ—Ç—ã –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ–ª–∏–∑—É:
```sql
SELECT * FROM support_tickets 
WHERE release_id = 'your-release-uuid'
ORDER BY created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–∫–µ—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ–ª–∏–∑–µ:
```sql
SELECT 
  t.*,
  r.title as release_title,
  r.artist_name,
  r.cover_url as artwork_url
FROM support_tickets t
LEFT JOIN releases r ON t.release_id = r.id
WHERE t.user_id = 'your-user-id';
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ–Ω**: –°–Ω–∞—á–∞–ª–∞ `releases`, –ø–æ—Ç–æ–º `tickets`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã releases
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Foreign key –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ò–Ω–¥–µ–∫—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "relation 'public.releases' does not exist"
**–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ `create_releases_unified.sql`

### –û—à–∏–±–∫–∞: "column 'release_id' already exists"
**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### –û—à–∏–±–∫–∞: "permission denied"
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ CREATE

## üìù –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```sql
-- –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ release_id –∏–∑ tickets
ALTER TABLE support_tickets DROP COLUMN IF EXISTS release_id;

-- –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É releases (–û–°–¢–û–†–û–ñ–ù–û! –£–¥–∞–ª–∏—Ç –≤—Å–µ —Ä–µ–ª–∏–∑—ã)
DROP TABLE IF EXISTS releases CASCADE;
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã tickets
\d support_tickets

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–∞
SELECT indexname FROM pg_indexes 
WHERE tablename = 'support_tickets' 
AND indexname = 'idx_support_tickets_release_id';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å foreign key
SELECT conname, conrelid::regclass, confrelid::regclass
FROM pg_constraint
WHERE conname LIKE '%release%';
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 25 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–ê–≤—Ç–æ—Ä**: THQ Label Development Team

# üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Ä–µ–ª–∏–∑–æ–≤

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Ä–æ–ª—å—é **Exclusive** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ª–∏–∑—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Ä–æ–ª—å—é **Basic** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ª–∏–∑—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é —Å –æ–ø–ª–∞—Ç–æ–π 500‚ÇΩ
- –ê–¥–º–∏–Ω–∞–º/–í–ª–∞–¥–µ–ª—å—Ü–∞–º ‚Äî –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —Ä–µ–ª–∏–∑—ã, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–ø–ª–∞—Ç—É, —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è—Ç—å —Ä–µ–ª–∏–∑—ã

## üóÑÔ∏è –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã releases

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase SQL Editor:

```bash
sql/update_releases_for_moderation.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –î–æ–±–∞–≤–∏—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `releases`:
  - `user_role` ‚Äî —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ('basic' –∏–ª–∏ 'exclusive')
  - `payment_status` ‚Äî —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã –¥–ª—è Basic ('pending', 'verified', 'rejected')
  - `payment_receipt_url` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–µ–∫ –æ–ø–ª–∞—Ç—ã
  - `payment_amount` ‚Äî —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã
  - `rejection_reason` ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Ä–µ–ª–∏–∑–∞
  - `moderated_by` ‚Äî ID –∞–¥–º–∏–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–ª
  - `moderated_at` ‚Äî –¥–∞—Ç–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Å—Ç SQL —Ñ—É–Ω–∫—Ü–∏–∏:
  - `get_pending_releases()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  - `approve_release(release_id, admin_id)` ‚Äî —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞
  - `reject_release(release_id, admin_id, reason)` ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞
  - `verify_payment(release_id, admin_id)` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
- –°–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–∏—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∞–¥–º–∏–Ω–æ–≤

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ Storage Buckets

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:

```bash
sql/CREATE_STORAGE_BUCKETS.sql
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Supabase Dashboard ‚Üí Storage:

1. **release-covers** (–ø—É–±–ª–∏—á–Ω—ã–π)
   - –î–ª—è –æ–±–ª–æ–∂–µ–∫ —Ä–µ–ª–∏–∑–æ–≤
   - –õ–∏–º–∏—Ç: 10MB
   - –¢–∏–ø—ã: image/jpeg, image/png, image/gif, image/webp

2. **payment-receipts** (–ø—É–±–ª–∏—á–Ω—ã–π, –Ω–æ —Å RLS)
   - –î–ª—è —á–µ–∫–æ–≤ –æ–ø–ª–∞—Ç—ã
   - –õ–∏–º–∏—Ç: 5MB
   - –¢–∏–ø—ã: image/jpeg, image/png, image/gif, image/webp
   - –î–æ—Å—Ç—É–ø: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –∏ –≤–ª–∞–¥–µ–ª–µ—Ü —á–µ–∫–∞

## ‚úÖ –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'releases';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_type = 'FUNCTION' 
AND routine_schema = 'public'
AND routine_name IN ('get_pending_releases', 'approve_release', 'reject_release', 'verify_payment');
```

### 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ Storage

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ buckets
SELECT id, name, public 
FROM storage.buckets 
WHERE id IN ('release-covers', 'payment-receipts');
```

## üé® –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Exclusive

1. –ö–∞–±–∏–Ω–µ—Ç ‚Üí –†–µ–ª–∏–∑—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ª–∏–∑
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å 7 —à–∞–≥–æ–≤ —Ñ–æ—Ä–º—ã
3. –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é"
4. –†–µ–ª–∏–∑ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏"

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Basic

1. –ö–∞–±–∏–Ω–µ—Ç ‚Üí –†–µ–ª–∏–∑—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ª–∏–∑
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã —Å —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏:
   - –°—É–º–º–∞: 500‚ÇΩ
   - –ö–∞—Ä—Ç–∞: 2200 7007 1234 5678
   - –°–ë–ü: +7 900 123 45 67
   - –ü–æ–ª—É—á–∞—Ç–µ–ª—å: THQ LABEL
3. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–ª–∏–∑–∞
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
6. –ê–¥–º–∏–Ω —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –æ–ø–ª–∞—Ç—É, –∑–∞—Ç–µ–º —É—Ç–≤–µ—Ä–¥–∏—Ç/–æ—Ç–∫–ª–æ–Ω–∏—Ç —Ä–µ–ª–∏–∑

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤/–≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

1. –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å ‚Üí –†–µ–ª–∏–∑—ã
2. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ä–µ–ª–∏–∑–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
3. –ö–ª–∏–∫ –Ω–∞ —Ä–µ–ª–∏–∑ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
   - –û–±–ª–æ–∂–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞—Ä—Ç–∏—Å—Ç
   - –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Basic/Exclusive)
   - –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (–¥–ª—è Basic)
   - –ß–µ–∫ –æ–ø–ª–∞—Ç—ã (–¥–ª—è Basic)
   - –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
   - –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è
   - –û–ø–∏—Å–∞–Ω–∏–µ
4. –î–µ–π—Å—Ç–≤–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏:
   - **–î–ª—è Basic**: —Å–Ω–∞—á–∞–ª–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É", –∑–∞—Ç–µ–º "–£—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–ª–∏–∑"
   - **–î–ª—è Exclusive**: —Å—Ä–∞–∑—É "–£—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–ª–∏–∑"
   - –ò–ª–∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å —Ä–µ–ª–∏–∑" —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ releases

```typescript
interface Release {
  id: string;
  user_id: string;
  user_role: 'basic' | 'exclusive';
  title: string;
  artist_name: string;
  cover_url: string;
  genre: string;
  subgenres: string[];
  release_date: string;
  tracks: Array<{
    title: string;
    link: string;
    hasDrugs: boolean;
    lyrics: string;
    language: string;
  }>;
  platforms: string[];
  countries: string[];
  collaborators: string[];
  focus_track: string;
  album_description: string;
  status: 'draft' | 'pending' | 'distributed' | 'rejected';
  payment_status: 'pending' | 'verified' | 'rejected' | null;
  payment_receipt_url: string | null;
  payment_amount: number | null;
  rejection_reason: string | null;
  contract_agreed: boolean;
  contract_agreed_at: string | null;
  moderated_by: string | null;
  moderated_at: string | null;
  created_at: string;
  updated_at: string;
}
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)

–ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ä–µ–ª–∏–∑—ã
- –ê–¥–º–∏–Ω—ã/–≤–ª–∞–¥–µ–ª—å—Ü—ã –≤–∏–¥—è—Ç –≤—Å–µ —Ä–µ–ª–∏–∑—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Basic –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —á–µ–∫–∏ —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ—é –ø–∞–ø–∫—É
- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —á–µ–∫–∏

## üöÄ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
1. Exclusive –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ª–∏–∑—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ
2. Basic –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—á–∏–≤–∞—é—Ç 500‚ÇΩ –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç —á–µ–∫
3. –ê–¥–º–∏–Ω—ã –º–æ–¥–µ—Ä–∏—Ä—É—é—Ç –≤—Å–µ —Ä–µ–ª–∏–∑—ã –≤ –µ–¥–∏–Ω–æ–π –ø–∞–Ω–µ–ª–∏
4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ß–µ–∫–∏ –æ–ø–ª–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `payment-receipts/{user_id}/{timestamp}.jpg`
- –û–±–ª–æ–∂–∫–∏ —Ä–µ–ª–∏–∑–æ–≤ –≤ –ø–∞–ø–∫–µ `release-covers/{user_id}/{timestamp}.jpg`
- –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–∏—á–∏–Ω—É
- Basic —Ä–µ–ª–∏–∑—ã –º–æ–∂–Ω–æ —É—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã

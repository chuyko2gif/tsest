# üîß –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –ü–û–í–¢–û–†–ù–û–ô –†–ï–ì–ò–°–¢–†–ê–¶–ò–ï–ô

## –ü—Ä–æ–±–ª–µ–º–∞
–í—ã —É–¥–∞–ª—è–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `profiles`, –Ω–æ –æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –≤ `auth.users`. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ç–µ–º –∂–µ email **–ø–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç**.

## –†–µ—à–µ–Ω–∏–µ –≤ 2 —à–∞–≥–∞

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

–û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–°–ö–ê–î–ù–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø –í –û–ë–ï –°–¢–û–†–û–ù–´

-- 1. –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ auth.users –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ profiles
CREATE OR REPLACE FUNCTION delete_auth_user_on_profile_delete()
RETURNS TRIGGER
SECURITY DEFINER
SET search_path = public
LANGUAGE plpgsql
AS $$
BEGIN
  DELETE FROM auth.users WHERE id = OLD.id;
  RETURN OLD;
END;
$$;

-- 2. –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS on_profile_delete_cascade_to_auth ON profiles;

CREATE TRIGGER on_profile_delete_cascade_to_auth
  BEFORE DELETE ON profiles
  FOR EACH ROW
  EXECUTE FUNCTION delete_auth_user_on_profile_delete();

-- 3. –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –≤ –æ–±—Ä–∞—Ç–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
ALTER TABLE profiles 
  DROP CONSTRAINT IF EXISTS profiles_id_fkey,
  ADD CONSTRAINT profiles_id_fkey 
    FOREIGN KEY (id) 
    REFERENCES auth.users(id) 
    ON DELETE CASCADE;
```

### –®–∞–≥ 2: –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ "–º–µ—Ä—Ç–≤—ã–µ" –∞–∫–∫–∞—É–Ω—Ç—ã

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ `auth.users` –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ `profiles`:

```sql
-- –ù–∞–π—Ç–∏ "–º–µ—Ä—Ç–≤—ã–µ" –∞–∫–∫–∞—É–Ω—Ç—ã (–µ—Å—Ç—å –≤ auth.users, –Ω–æ –Ω–µ—Ç –≤ profiles)
SELECT u.id, u.email, u.created_at
FROM auth.users u
LEFT JOIN profiles p ON u.id = p.id
WHERE p.id IS NULL;

-- –£–î–ê–õ–ò–¢–¨ –∏—Ö (–µ—Å–ª–∏ –Ω–∞—à–ª–∏—Å—å)
DELETE FROM auth.users
WHERE id IN (
  SELECT u.id
  FROM auth.users u
  LEFT JOIN profiles p ON u.id = p.id
  WHERE p.id IS NULL
);
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ê–¥–º–∏–Ω —É–¥–∞–ª—è–µ—Ç –∏–∑ profiles ‚Üí auth.users –æ—Å—Ç–∞–µ—Ç—Å—è ‚ùå
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è ‚Üí "Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" ‚ùå
–ü–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç ‚ùå
```

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ê–¥–º–∏–Ω —É–¥–∞–ª—è–µ—Ç –∏–∑ profiles ‚Üí auth.users —Ç–æ–∂–µ —É–¥–∞–ª—è–µ—Ç—Å—è ‚úÖ
Email –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤–æ–±–æ–¥–µ–Ω ‚úÖ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è ‚Üí –ü–∏—Å—å–º–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç ‚úÖ
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å email `test@example.com`
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email

2. **–£–¥–∞–ª–∏—Ç–µ –µ–≥–æ –∏–∑ –∞–¥–º–∏–Ω–∫–∏** (–∏–ª–∏ —á–µ—Ä–µ–∑ SQL):
   ```sql
   DELETE FROM profiles WHERE email = 'test@example.com';
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–Ω —É–¥–∞–ª–∏–ª—Å—è –∏–∑ auth.users:**
   ```sql
   SELECT * FROM auth.users WHERE email = 'test@example.com';
   -- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 0 —Å—Ç—Ä–æ–∫
   ```

4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞** —Å `test@example.com`:
   - –ü–∏—Å—å–º–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ ‚úÖ
   - –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ ‚úÖ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ö–æ–¥ —Ç–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

–ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –∏–ª–∏ –µ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞, –∫–æ–¥ –≤ [app/auth/page.tsx](../app/auth/page.tsx) —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ "User already registered".

## –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL:
- ‚úÖ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ `profiles` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ `auth.users`
- ‚úÖ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ `auth.users` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ `profiles`
- ‚úÖ Email –∏ nickname –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–∏—Å—å–º–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤—Å–µ–≥–¥–∞

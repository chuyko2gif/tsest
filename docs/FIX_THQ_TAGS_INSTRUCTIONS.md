# üö® –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Æ –¢–ï–ì–û–í THQ

## üìã –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ

–û—à–∏–±–æ—á–Ω–æ –∑–∞–º–µ–Ω–∏–ª–∏ –≤—Å–µ —Ç–µ–≥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å **THQ-** –Ω–∞ **thq-** –≤:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (member_id –≤ —Ç–∞–±–ª–∏—Ü–µ profiles)
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö ID
- ‚úÖ –ö–æ–¥ –Ω–∞ —Å–∞–π—Ç–µ (frontend)

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: `sql/FIX_THQ_TAGS_RESTORE.sql`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–∞–π–ª: `sql/ADMIN_ROLE_MANAGEMENT.sql`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 2. –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ `app/cabinet/page.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è member_id
- ‚úÖ `app/admin/components/UsersTab.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### 3. SQL —Å–∫—Ä–∏–ø—Ç—ã
- ‚úÖ `sql/fix_profile_trigger.sql`
- ‚úÖ `sql/fix_registration_without_email_confirmation.sql`
- ‚úÖ `sql/FIX_TRIGGER.sql`
- ‚úÖ `sql/add_email_to_profiles.sql`
- ‚úÖ `sql/create_profiles.sql`

## üìù –ü–û–†–Ø–î–û–ö –î–ï–ô–°–¢–í–ò–ô

### –®–ê–ì 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `sql/FIX_THQ_TAGS_RESTORE.sql`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **RUN** –∏–ª–∏ **F5**

**–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- üìä –ü–æ–∫–∞–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- üíæ –°–æ–∑–¥–∞—Å—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤ –ø–æ–ª–µ `member_id_backup`
- üîß –ó–∞–º–µ–Ω–∏—Ç –≤—Å–µ `thq-` –Ω–∞ `THQ-` –≤ —Ç–∞–±–ª–∏—Ü–µ profiles
- üîÑ –û–±–Ω–æ–≤–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üö™ –£–¥–∞–ª–∏—Ç –≤—Å–µ —Å–µ—Å—Å–∏–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—ã–π–¥—É—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã)
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –®–ê–ì 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä Next.js

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run dev
```

### –®–ê–ì 3: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã:**

1. **–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞**
   - –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞

2. **–í–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–∏ credentials
   - –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Ç–µ–≥–∏ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏: **THQ-XXXX**

3. **–ï—Å–ª–∏ —Ç–µ–≥–∏ –≤—Å—ë –µ—â—ë –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ:**
   
   **–í–∞—Ä–∏–∞–Ω—Ç –ê: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞**
   - –ù–∞–∂–º–∏—Ç–µ `Ctrl + Shift + Delete`
   - –í—ã–±–µ—Ä–∏—Ç–µ "–ö–µ—à" –∏ "Cookies"
   - –û—á–∏—Å—Ç–∏—Ç–µ
   - –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (`F5`)
   
   **–í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞**
   - –ù–∞–∂–º–∏—Ç–µ `F12` (–æ—Ç–∫—Ä—ã—Ç—å DevTools)
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Console**
   - –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥:
   ```javascript
   localStorage.clear();
   sessionStorage.clear();
   location.reload();
   ```
   - –ù–∞–∂–º–∏—Ç–µ `Enter`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (Supabase)
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ç–µ–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
SELECT 
  member_id,
  nickname,
  email,
  role
FROM public.profiles
ORDER BY created_at DESC
LIMIT 20;

-- –í—Å–µ member_id –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å THQ- (–∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)
```

### –ù–∞ —Å–∞–π—Ç–µ

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π member_id –≤ –ø—Ä–æ—Ñ–∏–ª–µ
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: **THQ-XXXX** (—Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)

## üîç –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –í –±–∞–∑–µ —Ç–µ–≥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –Ω–æ –Ω–∞ —Å–∞–π—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Å–µ—Å—Å–∏–∏ (–≤—ã–∫–∏–Ω–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
TRUNCATE TABLE auth.sessions RESTART IDENTITY CASCADE;
```

–ó–∞—Ç–µ–º –≤—Å–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∑–∞–π—Ç–∏.

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ–≥–∏ –≤ –±–∞–∑–µ –≤—Å—ë –µ—â—ë thq-

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
UPDATE public.profiles
SET member_id = REPLACE(member_id, 'thq-', 'THQ-')
WHERE member_id LIKE 'thq-%';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞
SELECT COUNT(*) as fixed_count
FROM public.profiles
WHERE member_id LIKE 'THQ-%';
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç thq- –≤–º–µ—Å—Ç–æ THQ-

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
DROP FUNCTION IF EXISTS public.generate_member_id();

CREATE OR REPLACE FUNCTION public.generate_member_id()
RETURNS TEXT
LANGUAGE plpgsql
AS $$
DECLARE
  new_member_id TEXT;
  id_exists BOOLEAN;
BEGIN
  LOOP
    new_member_id := 'THQ-' || LPAD(FLOOR(1000 + RANDOM() * 9000)::TEXT, 4, '0');
    
    SELECT EXISTS(
      SELECT 1 FROM public.profiles WHERE member_id = new_member_id
    ) INTO id_exists;
    
    EXIT WHEN NOT id_exists;
  END LOOP;
  
  RETURN new_member_id;
END;
$$;
```

## üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase:

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
  COUNT(*) as total_users,
  COUNT(CASE WHEN member_id LIKE 'THQ-%' THEN 1 END) as correct_tags,
  COUNT(CASE WHEN member_id LIKE 'thq-%' THEN 1 END) as incorrect_tags
FROM public.profiles;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
-- correct_tags = total_users
-- incorrect_tags = 0
```

## üéØ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç —Ç–µ–≥–∏ **THQ-XXXX**
- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Ç–µ–≥–∏ **THQ-XXXX**
- ‚úÖ –ù–∞ —Å–∞–π—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–≥–∏
- ‚úÖ –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Next.js —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase SQL Editor

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 26.12.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
